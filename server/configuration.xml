<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
xsi:schemaLocation=" http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd">

	<bean id="server" class="evaluationserver.server.execution.ServerImpl">
		<constructor-arg>
			<ref bean="datasource" />
		</constructor-arg>
		<constructor-arg>
			<ref bean="sandboxResolver" />
		</constructor-arg>
		<constructor-arg>
			<ref bean="compilerResolver" />
		</constructor-arg>
		<constructor-arg>
			<ref bean="fileManager" />
		</constructor-arg>
		<constructor-arg>
			<ref bean="inspector" />
		</constructor-arg>
	</bean>

	<!-- NOTIFICATION -->
	<bean id="notificators" class="evaluationserver.server.notification.NotificatorList">
		<constructor-arg>
			<list value-type="evaluationserver.server.notification.Notificator">
				<ref bean="timeNotificator" />
				<ref bean="tcpNotificator" />
			</list>
		</constructor-arg>
	</bean>
	<bean id="timeNotificator" class="evaluationserver.server.notification.TimeNotificator">
		<constructor-arg>
			<value>5000</value>
		</constructor-arg>
		<constructor-arg>
			<ref bean="blockingQueue" />
		</constructor-arg>
		<property name="name">
			<value>TimeNotificator</value>
		</property>
	</bean>
	<bean id="tcpNotificator" class="evaluationserver.server.notification.TCPNotificator">
		<constructor-arg>
			<value>5879</value>
		</constructor-arg>
		<constructor-arg>
			<ref bean="blockingQueue" />
		</constructor-arg>
		<property name="name">
			<value>TCPNotificator</value>
		</property>
	</bean>
	<!-- END NOTIFICATION -->

	<!-- COMPILERS -->
	<bean id="compilerResolver" class="evaluationserver.server.compile.CompilerResolverImpl">
		<constructor-arg>
			<map>
				<entry key="c" value-ref="cCompiler" />
			</map>
		</constructor-arg>
	</bean>
	<bean id="cCompiler" class="evaluationserver.server.compile.SystemCompiler">
		<constructor-arg>
			<value>gcc %input% -o %output%</value>
		</constructor-arg>
	</bean>
	<!-- END COMPILERS -->
	
	<!-- SANDBOXES -->
	<bean id="sandboxResolver" class="evaluationserver.server.sandbox.SandboxResolverImpl">
		<constructor-arg>
			<map>
				<entry key="c" value-ref="sandbox" />
			</map>
		</constructor-arg>
	</bean>
	<bean id="sandbox" class="evaluationserver.server.sandbox.SandboxImpl">
		<constructor-arg>
			<value>../tracer/dist/Release/GNU-Linux-x86/tracer %program% %inputData% %solutionData% ../temp/log.txt %timeLimit% %memoryLimit% %outputLimit%</value>
		</constructor-arg>		
	</bean>
	<!-- END SANDBOXES -->
	
	<!-- INSPECTION -->
	<bean id="inspector" class="evaluationserver.server.inspection.InspectorImpl">
		<constructor-arg>
			<value>%resolver% %solutionData% %inputData% %outputData% </value>
		</constructor-arg>
	</bean>
	<!-- END INSPECTION -->
	
	<!-- FILE MANAGMENT -->
	<bean id="fileManager" class="evaluationserver.server.filemanagment.FileManagerImpl">
		<constructor-arg>
			<value>../temp/</value>
		</constructor-arg>
	</bean>
	<!-- END FILE MANAGMENT -->
	
	<bean id="blockingQueue" class="evaluationserver.server.datasource.DataSourceBlockingQueue">
		<constructor-arg>
			<ref bean="datasource" />
		</constructor-arg>
	</bean>
	<bean id="datasource" class="evaluationserver.server.dbdatasource.DBDataSource">
		<constructor-arg>
			<ref bean="entityManager" />
		</constructor-arg>
	</bean>
	
	
<!--	<bean id="entityManagerFactory" class="org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean">  
		<property name="persistenceUnitName" value="PersistenceUnit"/>  
		<property name="dataSource" ref="jpaDataSource"/>  
		<property name="persistenceXmlLocation" value="classpath:my/test/dao/jpa/persistence.xml"/>  
		<property name="loadTimeWeaver">          
			<bean class="org.springframework.instrument.classloading.InstrumentationLoadTimeWeaver"/>  
		</property>  
		<property name="jpaVendorAdapter">  
			<bean class="org.springframework.orm.jpa.vendor.EclipseLinkJpaVendorAdapter">  
				<property name="generateDdl" value="false"/>  
				<property name="database" value="MYSQL"/>  
				<property name="databasePlatform" value="org.eclipse.persistence.platform.database.MySQLPlatform"/>  
			</bean>  
		</property>  
	</bean>  	
	<bean id="jpaDataSource" class="org.springframework.jdbc.datasource.DriverManagerDataSource">
		<property name="driverClassName" value="com.mysql.jdbc.Driver"/>
		<property name="url" value="jdbc:mysql://localhost:3306/evaluationserver"/>
		<property name="username" value="root"/>
		<property name="password" value="root"/>
	</bean>-->
	
	
	<bean id="entityManager" factory-bean="entityManagerFactory" factory-method="createEntityManager">
	</bean>
	<bean id="entityManagerFactory" class="javax.persistence.Persistence" factory-method="createEntityManagerFactory">
		<constructor-arg>
			<value>PersistenceUnit</value>
		</constructor-arg>
	</bean>

</beans>